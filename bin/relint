#!/usr/bin/env python

# Copyright (c) 2014 Riverbed Technology, Inc.

from __future__ import print_function

import re
import argparse

import reschema


def start():
    # Command line arguments
    parser = argparse.ArgumentParser()
    parser.add_argument('filename', action='store',
                        help='RestSchema file to process')

    parser.add_argument('--verbose', '-v', action='count', default=0,
                        help='print status messages, or debug with -vv')

    args = parser.parse_args()

    Validator.set_verbosity(args.verbose)

    # Filenames
    if not args.filename:
        print("Input filename is required")
        parser.print_usage()
        sys.exit(1)

    print('Processing file: {}\n'.format(args.filename))

    # Let reschema parse the file
    sdef = reschema.servicedef.ServiceDef.create_from_file(args.filename)

    # lint loaded service definition
    failures = reschema.lint.lint(sdef)

    return failures

if __name__ == '__main__':
    failures = start()

    if failures > 0:
        print('\n** FAILED : {} errors detected **\n\n'.format(failures))
        sys.exit(1)
    else:
        print('\n** SUCCESS **\n\n')
        sys.exit(0)
